include/master-slave.inc
[connection master]
connection slave;
SET @old_debug_slave= @@global.debug;
set global debug_dbug="+d,start_alter_delay_slave";
stop slave;
SET GLOBAL slave_parallel_threads=10;
set global slave_parallel_mode=optimistic;
start slave;
connection master;
SET @old_debug_master= @@global.debug;
set global debug_dbug="+d,start_alter_delay_master";
set global binlog_split_alter=true;
create table t1( a int primary key, b int) engine=myisam;
create table t2( a int primary key, b int) engine=myisam;
connect  con1,localhost,root,,;
connect  con2,localhost,root,,;
connection con1;
alter table t1 add column c int;;
connection con2;
alter table t2 add column c int;;
connection slave;
select master_gtid_wait('0-1-4');
master_gtid_wait('0-1-4')
0
select @@gtid_binlog_state;
@@gtid_binlog_state
0-1-4
select @@gtid_slave_pos;
@@gtid_slave_pos
0-1-4
include/stop_slave.inc
connection con1;
connection con2;
create table t3( a int primary key, b int) engine=innodb;
connection slave;
include/start_slave.inc
connection master;
connection slave;
show create table t1;
Table	Create Table
t1	CREATE TABLE `t1` (
  `a` int(11) NOT NULL,
  `b` int(11) DEFAULT NULL,
  `c` int(11) DEFAULT NULL,
  PRIMARY KEY (`a`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1
connection master;
SET GLOBAL debug_dbug= @old_debug_master;
drop table t1,t2,t3;
set global binlog_split_alter= false;
connection slave;
SET GLOBAL debug_dbug= @old_debug_slave;
stop slave;
SET GLOBAL slave_parallel_threads=0;
set global slave_parallel_mode=conservative;
start slave;
include/rpl_end.inc
